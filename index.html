<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Birthday Wishes â€“ Pravallika Vadla (Local Logic Test)</title>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<style>
  body {
    margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #ff9a9e, #fad0c4);
    text-align: center; color: #333; overflow-x: hidden;
  }
  
  .page { display: none; min-height: 100vh; padding: 40px 10px; box-sizing: border-box; }
  .page.active { display: block; }

  button {
    padding: 12px 25px; border-radius: 30px; border: none;
    background: linear-gradient(45deg, #ff4d6d, #ff758c);
    color: white; font-size: 16px; font-weight: bold; cursor: pointer;
    box-shadow: 0 4px 15px rgba(230, 57, 80, 0.3);
    transition: 0.3s; margin: 5px; position: relative; z-index: 100;
  }
  button:disabled { background: #aaa; cursor: not-allowed; opacity: 0.7; }

  #typewriter {
    max-width: 600px; margin: 20px auto; font-size: 18px; 
    line-height: 1.6; min-height: 80px; font-style: italic; padding: 0 15px;
  }

  /* Swiper Styles */
  .swiper { width: 300px; height: 380px; padding: 20px; margin: 10px auto; }
  .swiper-slide {
    background: white; border-radius: 5px; box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    display: flex; flex-direction: column; align-items: center;
    padding: 12px; box-sizing: border-box; border: 1px solid #ddd;
  }
  .swiper-slide img { width: 100%; height: 260px; object-fit: cover; border: 1px solid #eee; }
  .polaroid-caption { font-family: 'Brush Script MT', cursive; font-size: 20px; margin-top: 10px; color: #444; }

  /* Guest Book Styling */
  #messages-container { display: flex; flex-direction: column; align-items: center; gap: 20px; padding: 20px; }
  .wish-card { background: #ffff88; width: 90%; max-width: 450px; padding: 15px; box-shadow: 5px 5px 15px rgba(0,0,0,0.1); text-align: left; }
  .card-actions { border-top: 1px solid rgba(0,0,0,0.1); margin-top: 10px; padding-top: 10px; }
  .comment-section { margin-top: 10px; font-size: 14px; background: rgba(255,255,255,0.5); padding: 10px; border-radius: 5px; }
  .comment-item { border-bottom: 1px solid rgba(0,0,0,0.05); padding: 3px 0; }
  .comment-input-area { display: flex; margin-top: 5px; gap: 5px; }

  /* Effects */
  .effect { position: fixed; top: -50px; animation: fall linear infinite; z-index: 10; pointer-events: none; }
  @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
  .scavenger-item { cursor: pointer; font-size: 40px; position: absolute; z-index: 1000; }
  .scavenger-item.found { display: none; }

  #musicToggle {
    position: fixed; bottom: 20px; right: 20px; z-index: 200;
    width: 50px; height: 50px; border-radius: 50%; background: white;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center;
    cursor: pointer; font-size: 24px;
  }
</style>
</head>
<body>

<audio id="bgMusic" loop><source src="https://www.orangefreesounds.com/wp-content/uploads/2016/08/Happy-birthday-instrumental.mp3" type="audio/mpeg"></audio>
<div id="musicToggle" onclick="toggleMusic()">ğŸµ</div>

<div class="page active" id="page1">
  <h1>ğŸ‰ Something Amazing Awaiting For You ğŸ‰</h1>
  <p style="color:white;">Everything unlocked for final check.</p>
  <button id="entryBtn" onclick="goToPage(2)">Go to Birthday Wishes ğŸ‚</button>
  
  <div id="testNav" style="margin-top: 20px; border-top: 1px dashed white; padding-top: 20px;">
      <p style="color: white; font-weight: bold;">Quick Jump:</p>
      <button onclick="goToPage(2)" style="background: #4CAF50;">Memories ğŸˆ</button>
      <button onclick="goToPage(4)" style="background: #2196F3;">Guest Book âœï¸</button>
  </div>
</div>

<div class="page" id="page2">
  <h1>Special Wishes ğŸ’–</h1>
  <div id="typewriter"></div>
  <div class="swiper">
    <div class="swiper-wrapper">
      <div class="swiper-slide"><img src="https://raw.githubusercontent.com/akhilbevara/Birthday/main/pics/pic1.jpeg"><div class="polaroid-caption">Memory 1 ğŸˆ</div></div>
      <div class="swiper-slide"><img src="https://raw.githubusercontent.com/akhilbevara/Birthday/main/pics/pic2.jpeg"><div class="polaroid-caption">Memory 2 ğŸ˜Š</div></div>
      <div class="swiper-slide"><img src="https://raw.githubusercontent.com/akhilbevara/Birthday/main/pics/pic3.jpeg"><div class="polaroid-caption">Memory 3 ğŸ’–</div></div>
      <div class="swiper-slide"><img src="https://raw.githubusercontent.com/akhilbevara/Birthday/main/pics/pic4.jpeg"><div class="polaroid-caption">Memory 4 âœ¨</div></div>
      <div class="swiper-slide"><img src="https://raw.githubusercontent.com/akhilbevara/Birthday/main/pics/Pic5.jpeg"><div class="polaroid-caption">Memory 5 ğŸŒ¸</div></div>
      <div class="swiper-slide"><img src="https://raw.githubusercontent.com/akhilbevara/Birthday/main/pics/pic6.jpeg"><div class="polaroid-caption">Memory 6 ğŸ’</div></div>
      <div class="swiper-slide"><img src="https://raw.githubusercontent.com/akhilbevara/Birthday/main/pics/pic9.jpeg"><div class="polaroid-caption">Memory 7 ğŸŒŸ</div></div>
    </div>
  </div>
  <p id="starTracker" style="font-weight:bold; color: #ff4d6d;">Stars Found: 0/3</p>
  <button onclick="goToPage(4)">Go to Guest Book ğŸ“–</button>
</div>

<div class="page" id="page4">
  <h1>ğŸ“– The Guest Book</h1>
  <div class="input-group">
    <input type="text" id="senderName" placeholder="Your Name">
    <textarea id="senderMsg" rows="2" placeholder="Write something sweet..."></textarea>
    <button id="postBtn">Post Wish ğŸ’Œ</button>
  </div>
  <button id="unlockWheelBtn" onclick="goToPage(3)" style="display:none; background:#4CAF50;">âœ¨ UNLOCKED: Spin the Wheel ğŸ¡ âœ¨</button>
  <div id="messages-container"></div>
  <button onclick="goToPage(2)" style="background: #777;">Back to Photos ğŸ”™</button>
</div>

<div class="page" id="page3">
  <h1>ğŸ¡ The Birthday Gift Wheel ğŸ¡</h1>
  <canvas id="wheelCanvas" width="350" height="350" style="margin:auto; display:block;"></canvas><br>
  <button id="spinBtn" onclick="spinWheel()">Spin for a Gift!</button>
  <h2 id="giftResult" style="color: #ff4d6d; min-height: 40px;"></h2>
  <button onclick="goToPage(4)">Back to Guest Book ğŸ”™</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getDatabase, ref, push, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCgWYC7M9MdvFEpgSkNIrnXUlf57_YeTb4",
    authDomain: "pravallikabirthday-eea91.firebaseapp.com",
    databaseURL: "https://pravallikabirthday-eea91-default-rtdb.firebaseio.com",
    projectId: "pravallikabirthday-eea91",
    storageBucket: "pravallikabirthday-eea91.firebasestorage.app",
    messagingSenderId: "742416208965",
    appId: "1:742416208965:web:34152005176d9f4ead3f2c"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const messagesRef = ref(db, 'wishes');

  document.getElementById('postBtn').onclick = () => {
    const name = document.getElementById('senderName').value;
    const msg = document.getElementById('senderMsg').value;
    if(name && msg) {
      push(messagesRef, { name, msg, likes: 0, comments: {} });
      document.getElementById('senderName').value = '';
      document.getElementById('senderMsg').value = '';
      confetti({ particleCount: 100, spread: 70, origin: { y: 0.8 } });
    }
  };

  window.likeMessage = (id) => {
    const likeRef = ref(db, `wishes/${id}/likes`);
    runTransaction(likeRef, (c) => (c || 0) + 1);
  };

  window.addComment = (id) => {
    const cin = document.getElementById(`comment-in-${id}`);
    if(cin.value) {
      push(ref(db, `wishes/${id}/comments`), { text: cin.value });
      cin.value = '';
    }
  };

  onValue(messagesRef, (snap) => {
    const cont = document.getElementById('messages-container');
    cont.innerHTML = '';
    const data = snap.val();
    if(data) {
      Object.keys(data).reverse().forEach(id => {
        const w = data[id];
        let cHTML = '';
        if(w.comments) Object.values(w.comments).forEach(c => cHTML += `<div class="comment-item">ğŸ’¬ ${c.text}</div>`);
        cont.innerHTML += `
          <div class="wish-card">
            <h3>${w.name}</h3><p>${w.msg}</p>
            <div class="card-actions"><button onclick="likeMessage('${id}')" style="background:none; color:#ff4d6d; box-shadow:none;">â¤ï¸ ${w.likes || 0}</button></div>
            <div class="comment-section">${cHTML}
              <div class="comment-input-area"><input type="text" id="comment-in-${id}" placeholder="Reply..."><button onclick="addComment('${id}')" style="padding:2px 8px; font-size:12px;">Add</button></div>
            </div>
          </div>`;
      });
    }
  });
</script>

<script>
let swiperInstance = null, starsFound = 0, musicPlaying = false;

function toggleMusic() {
    const audio = document.getElementById('bgMusic');
    const btn = document.getElementById('musicToggle');
    if (musicPlaying) { audio.pause(); btn.innerText = "ğŸ”‡"; } 
    else { audio.play().catch(()=>{}); btn.innerText = "ğŸµ"; }
    musicPlaying = !musicPlaying;
}

function goToPage(num) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page'+num).classList.add('active');
  if(num >= 2 && !musicPlaying) toggleMusic();
  if(num === 2) {
    startTypewriter();
    if(!swiperInstance) swiperInstance = new Swiper('.swiper', { effect: 'cards', grabCursor: true, loop: true });
  }
  window.scrollTo(0,0);
}

function startTypewriter() {
  const el = document.getElementById('typewriter');
  if(el.innerHTML !== "") return;
  const str = "Happy Birthday to the amazing Pravallika! ğŸ‚ You truly make the world a brighter and more beautiful place just by being yourself. âœ¨ğŸ’– May your day be overflowing with as much love, laughter, and magic as you generously give to everyone around you! ğŸŒ¸ğŸ¥‚ Keep shining like the star you are! ğŸ’ğŸ’•";
  let i = 0;
  function type() { if(i < str.length) { el.innerHTML += str.charAt(i++); setTimeout(type, 50); } }
  type();
}

function collectStar(el) {
  if (!el.classList.contains('found')) {
    el.classList.add('found');
    starsFound++;
    document.getElementById('starTracker').innerText = `Stars Found: ${starsFound}/3`;
    confetti({ particleCount: 50 });
    if (starsFound === 3) document.getElementById('unlockWheelBtn').style.display = 'inline-block';
  }
}

function placeStars() {
  const spots = [{p:'page1',t:'10%',l:'10%'}, {p:'page2',t:'80%',l:'80%'}, {p:'page4',t:'70%',l:'10%'}];
  spots.forEach(s => {
    const star = document.createElement('div');
    star.className = 'scavenger-item'; star.innerHTML = 'â­';
    star.style.top = s.t; star.style.left = s.l;
    star.onclick = () => collectStar(star);
    document.getElementById(s.p).appendChild(star);
  });
}

const icons=['ğŸ‰','ğŸ’–','ğŸŒ¸','ğŸ’','â¤ï¸'];
setInterval(()=>{
  const e=document.createElement('div'); e.className='effect';
  e.innerText=icons[Math.floor(Math.random()*icons.length)];
  e.style.left=Math.random()*100+'vw'; e.style.animationDuration=5+Math.random()*5+'s';
  document.body.appendChild(e); setTimeout(()=>e.remove(),10000);
},400);

// WHEEL LOGIC
const gifts = ["Chocolates ğŸ«", "Teddy ğŸ§¸", "Hand Bag ğŸ‘œ", "Try Again ğŸ”„", "Surprise ğŸ", "Speaker ğŸ”Š"];
const canvas = document.getElementById("wheelCanvas");
const ctx = canvas.getContext("2d");

function drawWheel(rot = 0) {
  const arc = Math.PI*2/6;
  ctx.clearRect(0,0,350,350);
  for(let i=0; i<6; i++) {
    ctx.beginPath(); ctx.fillStyle = ["#ffbe0b","#fb5607","#ff006e","#8338ec","#3a86ff","#06d6a0"][i];
    ctx.moveTo(175,175); ctx.arc(175,175,170, i*arc+rot, (i+1)*arc+rot); ctx.fill();
    ctx.save(); ctx.translate(175,175); ctx.rotate(i*arc+rot+arc/2);
    ctx.textAlign="right"; ctx.fillStyle="#fff"; ctx.font="bold 16px Arial"; ctx.fillText(gifts[i], 160, 5); ctx.restore();
  }
}
drawWheel(0);

function spinWheel() {
  const btn = document.getElementById('spinBtn');
  const res = document.getElementById('giftResult');
  btn.disabled = true; res.innerText = "Spinning...";
  let start = performance.now(), duration = 4000, totalRot = 1440 + Math.random() * 360; 
  function animate(t) {
    let prog = Math.min((t-start)/duration, 1), ease = 1 - Math.pow(1 - prog, 3);
    drawWheel((totalRot * ease) * Math.PI/180);
    if(prog < 1) requestAnimationFrame(animate);
    else {
        let final = totalRot % 360, index = Math.floor(((360 - final + 270) % 360) / 60);
        let won = gifts[index];
        if(won.includes("Try Again")) { res.innerText = "Try Again ğŸ”„"; btn.disabled = false; } 
        else { res.innerText = "Winner: " + won + "! ğŸ‰"; confetti({ particleCount: 200 }); btn.innerText = "Claimed! ğŸ†"; }
    }
  }
  requestAnimationFrame(animate);
}
window.onload = placeStars;
</script>
</body>
</html>

